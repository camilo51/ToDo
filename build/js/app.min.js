
const formulario=document.querySelector(".formulario");const titulo=formulario.querySelector('#titulo');const categoria=document.querySelectorAll('#categoria');const precio=formulario.querySelector('#precio');const agregar=formulario.querySelector('#agregar');const agregarContenedor=document.querySelector('.agregar-contenedor');const anuncios=document.querySelector('.anuncios');const botonAgregar=document.querySelector('#boton-agregar')
const botonEnviar=document.querySelector('#boton-enviar')
const lista=document.querySelector('#lista')
const gastoTotal=document.querySelector('#gasto-total');let errores=[];let erroresFormulario=[];let erroresCategorias=[];let getCategorias=JSON.parse(localStorage.getItem("categoria"))??[];let getGastos=JSON.parse(localStorage.getItem("gasto"))??[];let nuevaCategoria=getCategorias;let gastoContenedor=getGastos;let categoriaValida=false;window.addEventListener("load",function(){agregarSecciones()
agregarLista()
mostrarGastos()});console.log(getGastos);console.log(gastoContenedor);const mostrarGastos=()=>{let gastoInicial=0;getGastos.forEach(entry=>{let valorGasto=parseInt(entry.precio)
gastoTotal.innerHTML=`$${ gastoInicial = gastoInicial + valorGasto}`});}
const filtro=()=>{if(categoria[1].selectedIndex>0){}}
const validacionCategoria=()=>{errores=[];if(agregar.value===""||agregar.value===null){errores.push('Debes escribir un valor de categoria.')}else{if(validarCategoria()){errores.push('Esta categoria ya existe')}else{errores=[];anuncios.innerHTML='';}}}
const validacionFormulario=()=>{errores=[];if(titulo.value===""||titulo.value===null){errores.push('Debes agregar un titulo.')}
if(precio.value===""||precio.value===null){errores.push('Debes agregar un precio.')}
if(getCategorias.length>0){if(categoria[0].selectedIndex<=0){errores.push('Debes seleccionar una categoria.')}}else{errores.push('Debes agregar una categoria.')}}
const mostrarErrores=()=>{anuncios.innerHTML="";errores.forEach(error=>anuncios.innerHTML+=`<p class="anuncio error"> ${error}</p>`);setTimeout(()=>{anuncios.innerHTML='';},4500);errores=[];}
const agregarSecciones=()=>{categoria.forEach(element=>{element.innerHTML=`<option disabled selected >---Seleccionar---</option>`;});getCategorias.forEach((entry,key)=>{categoria.forEach(element=>element.innerHTML+=`<option value="${key}">${entry.categoria}</option>`)})}
const agregarLista=()=>{lista.innerHTML='';getGastos.forEach((entry,key)=>{lista.innerHTML+=` <tr>
                                <td>${key+1}</td>
                                <td>${entry.titulo}</td>
                                <td>${entry.categoria}</td>
                                <td id="precio">$${entry.precio}</td>
                                </tr>`});}
function CrearCategoria(categoria){this.categoria=categoria;}
const subirCategoria=()=>{const nombreCategoria=new CrearCategoria(agregar.value.toUpperCase());nuevaCategoria.push(nombreCategoria)
localStorage.setItem("categoria",JSON.stringify(nuevaCategoria));anuncios.innerHTML+=`<p class="anuncio bueno">la categoria "${agregar.value}" se agrego correctamente</p>`;setTimeout(()=>{anuncios.innerHTML='';},4500);agregarSecciones();agregar.value='';}
function NuevoGasto(titulo,categoria,precio){this.titulo=titulo,this.categoria=categoria,this.precio=precio}
const gastosStorage=()=>{const gasto=new NuevoGasto(titulo.value,categoria[0].options[categoria[0].selectedIndex].innerText,precio.value)
gastoContenedor.push(gasto)
localStorage.setItem('gasto',JSON.stringify(gastoContenedor))
agregarLista()
mostrarGastos()
anuncios.innerHTML=`<p class="anuncio bueno">Se agrego correctamente</p>`;setTimeout(()=>{anuncios.innerHTML='';},4500);titulo.value='';precio.value='';categoria.selectedIndex=0;}
const validarCategoria=()=>{erroresCategorias=[];categoriaValida=false
for(let i=0;i<getCategorias.length;i++){if(getCategorias[i].categoria===agregar.value.toUpperCase()){categoriaValida=true;break;}}
return categoriaValida;}
botonAgregar.addEventListener('click',()=>{validacionCategoria()
errores.length>0?mostrarErrores():subirCategoria();})
botonEnviar.addEventListener('click',()=>{validacionFormulario()
errores.length>0?mostrarErrores():gastosStorage();})
formulario.addEventListener('submit',e=>e.preventDefault())